<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	
	<title>Alencon sous surveillance - demo</title>

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="shortcut icon" type="image/x-icon" href="https://leafletjs.com/examples/quick-start/docs/images/favicon.ico">

    <link rel="stylesheet" href="static/leaflet.css">
    <script src="static/leaflet.js"></script>


	
</head>
<body>



<div id="mapid" style="width: 600px; height: 400px; position: relative;"></div>
<button onclick="exportCameras()">Exporter ma liste</button>

<script>
	var mymap = L.map('mapid').setView([48.428, 0.088921], 13);

	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11',
		tileSize: 512,
		zoomOffset: -1
	}).addTo(mymap);


	localStorage.cameras = localStorage.cameras || "[]";
	var cameras = JSON.parse(localStorage.cameras);

	for (var i=0; i<cameras.length; i++){
		L.marker([cameras[i][0], cameras[i][1]]).addTo(mymap)
		.bindPopup("<b>Caméra signalée !</b><br /><button onclick=\"removeCamera(" + i + ")\">Supprimer</button>");
	}
	// L.marker([48.428, 0.088921]).addTo(mymap)
	// 	.bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();
	
	function addCamera(lat, lng){
		cameras.push([lat, lng]);
		localStorage.cameras = JSON.stringify(cameras);
		L.marker([lat, lng]).addTo(mymap)
		.bindPopup("<b>Caméra signalée !</b><br /><button onclick=\"removeCamera(" + cameras.length + ")\">Supprimer</button>");
		mymap.closePopup();
	}
	
	function removeCamera(i){
		cameras.splice(i,1);
		localStorage.cameras = JSON.stringify(cameras);
		location=location;
		mymap.closePopup();
	}

	var popup = L.popup();

	function onMapClick(e) {
		popup
			.setLatLng(e.latlng)
			.setContent("Signaler une caméra à " + e.latlng.toString() + " ?<br/><button onclick=\"addCamera(" + e.latlng.lat+","+e.latlng.lng + ")\">Ajouter</button>")
			.openOn(mymap);
	}

	mymap.on('click', onMapClick);


	function exportCameras(){
		prompt("Liste de coordonées relevées", localStorage.cameras);
	}
</script>

<style type="text/css">
img.leaflet-marker-icon {
	background-color: blue;
}
</style>



</body></html>